<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Temp Mail</title>

<style>
:root {
  --bg:#020617;
  --card:#0f172a;
  --accent:#22d3ee;
  --accent2:#2563eb;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:radial-gradient(circle at top,#020617,#000);
  color:var(--text)
}
header{
  text-align:center;
  padding:20px;
  font-size:26px;
  font-weight:800
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px
}
.card{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  box-shadow:0 0 40px #000
}
.email{
  background:#020617;
  padding:14px;
  border-radius:12px;
  font-size:18px;
  word-break:break-all
}
.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center
}
button{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  border:none;
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600
}
button.secondary{
  background:#020617;
  border:1px solid #1e293b
}
button:hover{opacity:.9}
.inbox{margin-top:20px}
.message{
  background:#020617;
  border-radius:12px;
  padding:14px;
  margin-bottom:10px;
  cursor:pointer
}
.message:hover{background:#020617cc}
.subject{color:var(--muted);font-size:14px}
.empty{text-align:center;color:var(--muted);margin:30px}
.footer{text-align:center;color:var(--muted);font-size:13px;margin-top:30px}
</style>
</head>

<body>

<header>ðŸ“¬ TEMP MAIL</header>

<div class="container">
  <div class="card">
    <div class="row">
      <div class="email" id="email">Loadingâ€¦</div>
      <button onclick="copyEmail()">Copy</button>
    </div>

    <div class="row" style="margin-top:12px">
      <button onclick="newEmail()">New Email</button>
      <button class="secondary" onclick="loadInbox()">Refresh</button>
      <button class="secondary" id="autoBtn" onclick="toggleAuto()">
        Auto Refresh: OFF
      </button>
    </div>
  </div>

  <div class="card inbox" id="inbox"></div>

  <div class="footer">
    Powered by mail.tm â€¢ Better deliverability â€¢ Auto-delete emails
  </div>
</div>

<script>
let token = "";
let accountId = "";
let address = "";
let autoTimer = null;

function rand(len){
  const c="abcdefghijklmnopqrstuvwxyz0123456789";
  return Array.from({length:len},()=>c[Math.floor(Math.random()*c.length)]).join("");
}

async function newEmail(){
  localStorage.clear();
  const domains = await fetch("https://api.mail.tm/domains").then(r=>r.json());
  const domain = domains["hydra:member"][0].domain;
  address = `${rand(10)}@${domain}`;
  const password = rand(12);

  await fetch("https://api.mail.tm/accounts",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({address,password})
  });

  const login = await fetch("https://api.mail.tm/token",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({address,password})
  }).then(r=>r.json());

  token = login.token;
  localStorage.setItem("tm_address",address);
  localStorage.setItem("tm_token",token);

  document.getElementById("email").textContent = address;
  document.getElementById("inbox").innerHTML =
    "<div class='empty'>Inbox empty</div>";
}

async function loadInbox(){
  if(!token) return;
  const inbox=document.getElementById("inbox");
  inbox.innerHTML="<div class='empty'>Loadingâ€¦</div>";

  const data = await fetch("https://api.mail.tm/messages",{
    headers:{Authorization:`Bearer ${token}`}
  }).then(r=>r.json());

  if(!data["hydra:member"].length){
    inbox.innerHTML="<div class='empty'>No messages yet</div>";
    return;
  }

  inbox.innerHTML="";
  data["hydra:member"].forEach(msg=>{
    const div=document.createElement("div");
    div.className="message";
    div.innerHTML=`
      <strong>${msg.from.address}</strong>
      <div class="subject">${msg.subject||"(no subject)"}</div>
    `;
    div.onclick=()=>openMsg(msg.id);
    inbox.appendChild(div);
  });
}

async function openMsg(id){
  const msg = await fetch(`https://api.mail.tm/messages/${id}`,{
    headers:{Authorization:`Bearer ${token}`}
  }).then(r=>r.json());

  alert(
    `From: ${msg.from.address}\n\nSubject: ${msg.subject}\n\n${msg.text || "No content"}`
  );
}

function copyEmail(){
  navigator.clipboard.writeText(address);
}

function toggleAuto(){
  const btn=document.getElementById("autoBtn");
  if(autoTimer){
    clearInterval(autoTimer);
    autoTimer=null;
    btn.textContent="Auto Refresh: OFF";
  }else{
    loadInbox();
    autoTimer=setInterval(loadInbox,30000);
    btn.textContent="Auto Refresh: ON (30s)";
  }
}

(function init(){
  const savedA=localStorage.getItem("tm_address");
  const savedT=localStorage.getItem("tm_token");
  if(savedA && savedT){
    address=savedA;
    token=savedT;
    document.getElementById("email").textContent=address;
    loadInbox();
  }else{
    newEmail();
  }
})();
</script>

</body>
</html>
